var J=Object.defineProperty;var Q=(y,m,p)=>m in y?J(y,m,{enumerable:!0,configurable:!0,writable:!0,value:p}):y[m]=p;var h=(y,m,p)=>Q(y,typeof m!="symbol"?m+"":m,p);(function(){"use strict";class y{constructor(t=4096){h(this,"next");h(this,"data");h(this,"length",0);h(this,"head",0);this.cap=t,this.data=new Array(t)}get can_push(){return this.length<this.cap}get can_pop(){return this.head<this.length}push(t){this.data[this.length++]=t}pop(){return this.data[this.head++]}reset(){this.length=0,this.head=0,this.next=void 0}}class m{constructor(){h(this,"pull",[]);h(this,"head",new y);h(this,"tail",this.head)}push(t){if(!this.tail.can_push){const e=this.newChunk();this.tail.next=e,this.tail=e}this.tail.push(t)}pop(){if(this.head.can_pop)return this.head.pop();if(this.head.can_push||!this.head.next)throw new Error("Unexpected pop from empty queue");return this.pull.push(this.head),this.head=this.head.next,this.head.pop()}isEmpty(){return this.head===this.tail&&!this.head.can_pop}newChunk(){return new y}}class p{constructor(t,e){this.field=t,this.empty=e}static fromArray(t){let e=0;for(let i=0;i<16;i++)if(t[i]===0){e=i;break}return new p(t.slice(0),e)}static fromArrayUint(t){const e=new Uint8Array(16);let i=0;for(let s=0;s<16;s++)t[s]===0&&(i=s),e[s]=t[s];return new p(e,i)}canMove(t){const e=this.empty%4;switch(t){case 0:return this.empty>3;case 2:return this.empty<12;case 3:return e>0;case 1:return e<3}return!1}makeMove(t){return this.copy().makeMoveInPlace(t)}makeMoveInPlace(t){let e=this.empty;switch(t){case 0:e=this.empty-4;break;case 2:e=this.empty+4;break;case 3:e=this.empty-1;break;case 1:e=this.empty+1;break}return this.field[this.empty]=this.field[e],this.field[e]=0,this.empty=e,this}copy(){return new p(this.field.slice(0),this.empty)}hash64(){const t=this.field,e=BigInt(t[3]<<12|t[2]<<8|t[1]<<4|t[0]),i=BigInt(t[7]<<12|t[6]<<8|t[5]<<4|t[4]),s=BigInt(t[11]<<12|t[10]<<8|t[9]<<4|t[8]),r=BigInt(t[15]<<12|t[14]<<8|t[13]<<4|t[12]);return BigInt.asUintN(64,r<<48n|s<<32n|i<<16n|e)}isSolution(){if(this.empty!=15)return!1;for(let t=0;t<15;t++)if(this.field[t]!=t+1)return!1;return!0}}const w=class w{constructor(t,e){this.field=t,this.empty=e}static fromArray(t){let e=0;for(let s=0;s<16;s++)if(t[s]===0){e=s;break}const i=new p(t.slice(0),e);return new w(i.hash64(),e)}canMove(t){return w.canMove(this.empty,t)}static canMove(t,e){const i=t%4;switch(e){case 0:return t>3;case 2:return t<12;case 3:return i>0;case 1:return i<3}return!1}makeMove(t){return this.copy().makeMoveInPlace(t)}static makeMove(t,e,i){let s=e;switch(i){case 0:s=e-4;break;case 2:s=e+4;break;case 3:s=e-1;break;case 1:s=e+1;break}const r=w.masks[s];let a=t&r;return a=a>>BigInt(s*4),a=a<<BigInt(e*4),t=t&~r|a,e=s,[t,e]}makeMoveInPlace(t){return[this.field,this.empty]=w.makeMove(this.field,this.empty,t),this}copy(){return new w(this.field,this.empty)}hash64(){return this.field}isSolution(){return this.field===w.solution}};h(w,"masks",[]),h(w,"solution",new p([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0],15).hash64());let k=w;for(let n=0;n<16;n++)k.masks[n]=0xfn<<BigInt(n*4);function d(n){return n.padEnd(16,"0").substring(0,16).split("").map(t=>parseInt(t,16))}d("123456789ABCDEF0"),d("1234067859ACDEBF"),d("5134207896ACDEBF"),d("16245A3709C8DEBF"),d("1723068459ACDEBF"),d("0723168459ACDEBF"),d("7023168459ACDEBF"),d("7203168459ACDEBF"),d("7283160459ACDEBF"),d("7283106459ACDEBF"),d("12345678A0BE9FCD"),d("51247308A6BE9FCD"),d("F2345678A0BE91DC"),d("75123804A6BE9FCD"),d("75AB2C416D389F0E"),d("04582E1DF79BCA36"),d("FE169B4C0A73D852"),d("D79F2E8A45106C3B"),d("DBE87A2C91F65034"),d("BAC0F478E19623D5");let C=class{constructor(){h(this,"fields",new BigUint64Array(65536/4*256));h(this,"data",new Int32Array(65536*256));h(this,"index",0)}push(t,e,i,s,r){if(this.index+=1,this.data.length<=this.index*4){const l=new Int32Array(this.data.length*2),u=new BigUint64Array(this.fields.length*2);for(let o=0;o<this.data.length;++o)l[o]=this.data[o];for(let o=0;o<this.fields.length;++o)u[o]=this.fields[o];this.data=l,this.fields=u}const a=(this.index-1)*4;this.data[a+0]=t,this.data[a+1]=e,this.data[a+2]=s,this.data[a+3]=r,this.fields[this.index-1]=i}from(t){return this.data[t*4+0]}op(t){return this.data[t*4+1]}valueField(t){return this.fields[t]}valueEmpty(t){return this.data[t*4+2]}depth(t){return this.data[t*4+3]}length(){return this.index}},M=class{constructor(t){this.newSet=t}solve(t){const e=new C,i=k.fromArray(t);if(i.isSolution())return{ok:!0,operations:[],visitedStates:1};e.push(-1,-1,i.field,i.empty,0);const s=this.newSet();s.add(i.hash64());for(let r=0;r<e.length();++r){const a=e.valueField(r),l=e.valueEmpty(r),u=e.depth(r);for(let o=0;o<4;++o){const c=o;if(!k.canMove(l,c))continue;const[f,B]=k.makeMove(a,l,c);if(s.add(f)){if(f===k.solution){const A=new Array(u+1);A[u]=c;for(let g=r;e.op(g)>=0;g=e.from(g))A[e.depth(g)-1]=e.op(g);return{ok:!0,operations:A,visitedStates:s.size()}}e.push(r,c,f,B,u+1)}}}return{ok:!1,operations:[],visitedStates:s.size()}}};class D{constructor(){h(this,"data",new BigUint64Array(65536*256+1));h(this,"count",0);h(this,"hasZero",!1)}get max_iteration(){return 15/65537*this.data.length|0}hash(t){return t=BigInt.asUintN(64,(t>>16n^t)*0x45d9f3bn),t=BigInt.asUintN(64,(t>>16n^t)*0x45d9f3bn),Number(t%BigInt(this.data.length))}add(t){if(t===0n)return this.hasZero?!1:(this.count++,this.hasZero=!0);let e=this.hash(t);const i=e;for(let s=0;s<this.max_iteration;++s){if(this.data[e]==t)return!1;if(this.data[e]==0n)return this.data[e]=t,this.count++,!0;e=(i+(s+1))%this.data.length}return this.rehash(),this.add(t)}size(){return this.count}rehash(){const t=this.data;this.data=new BigUint64Array((this.data.length-1)*2+1),this.count=+this.hasZero;for(let e=0;e<t.length;++e)t[e]!=0n&&this.add(t[e])}}class U{constructor(t,e){this.hash=t,this.newSet=e}solve(t,e,i){const s=new m;s.push({value:t,depth:0});const r=this.newSet();for(r.add(this.hash(t));!s.isEmpty();){const a=s.pop();for(let l=0;l<i.length;++l){const u=i[l];if(!u.correct(a.value))continue;const o=u.apply(a.value);if(r.add(this.hash(o))){if(o===e){const c=new Array(a.depth+1);c[a.depth]=u;for(let f=a;f.op;f=f.from)c[f.depth-1]=f.op;return{ok:!0,operations:c,visitedStates:r.size()}}s.push({from:a,op:u,value:o,depth:a.depth+1})}}}return{ok:!1,operations:[],visitedStates:r.size()}}}class z{constructor(){h(this,"data",new Int32Array(65536));h(this,"index",0)}push(t,e,i,s){if(this.index+=1,this.data.length<=this.index*4){const a=new Int32Array(this.data.length*2);for(let l=0;l<this.data.length;++l)a[l]=this.data[l];this.data=a}const r=(this.index-1)*4;this.data[r+0]=t,this.data[r+1]=e,this.data[r+2]=i,this.data[r+3]=s}from(t){return this.data[t*4+0]}op(t){return this.data[t*4+1]}value(t){return this.data[t*4+2]}depth(t){return this.data[t*4+3]}length(){return this.index}}class T{constructor(t,e){this.hash=t,this.newSet=e}solve(t,e,i){const s=new z;s.push(-1,-1,t,0);const r=this.newSet();r.add(this.hash(t));for(let a=0;a<s.length();++a){const l=s.value(a),u=s.depth(a);for(let o=0;o<i.length;++o){const c=i[o];if(!c.correct(l))continue;const f=c.apply(l),B=this.hash(f);if(r.add(B)){if(f===e){const A=new Array(u+1);A[u]=c;for(let g=a;s.op(g)>=0;g=s.from(g))A[s.depth(g)-1]=i[s.op(g)];return{ok:!0,operations:A,visitedStates:r.size()}}s.push(a,o,f,u+1)}}}return{ok:!1,operations:[],visitedStates:r.size()}}}class S{constructor(t,e=new E(t,this)){this.n=t,this.inverse=e}apply(t){return t+this.n}correct(){return!0}toString(){return`+${this.n}`}}class E{constructor(t,e=new S(t,this)){this.n=t,this.inverse=e}apply(t){return t-this.n}correct(){return!0}toString(){return`-${this.n}`}}class v{constructor(t,e=new Z(t,this)){this.n=t,this.inverse=e}apply(t){return t*this.n}correct(){return!0}toString(){return`*${this.n}`}}class Z{constructor(t,e=new v(t,this)){this.n=t,this.inverse=e}apply(t){return t/this.n}correct(t){return t%this.n===0}toString(){return`/${this.n}`}}class ${constructor(){h(this,"root");h(this,"count",0)}add(t){if(!this.root)return this.root={value:t,left:void 0,right:void 0},this.count++,!0;let e=this.root,i=this.root,s=!1;for(;e;)if(i=e,s=t<e.value,s)e=e.left;else if(e.value<t)e=e.right;else return!1;this.count++;const r={value:t,left:void 0,right:void 0};return s?i.left=r:i.right=r,!0}has(t){let e=this.root;for(;e;)if(t<e.value)e=e.left;else if(e.value<t)e=e.right;else return!0;return!1}size(){return this.count}}class N{constructor(){h(this,"data",Object.create(null));h(this,"count",0)}add(t){return this.data[t]?!1:(this.count++,this.data[t]=!0)}has(t){return this.data[t]}size(){return this.count}}class L{constructor(){h(this,"data",new Int32Array(65537));h(this,"max_iteration",15);h(this,"count",0);h(this,"hasZero",!1)}hash(t){return t=(t>>16^t)*73244475|0,t=(t>>16^t)*73244475|0,t=t>>16^t|0,t%this.data.length}add(t){if(t===0)return this.hasZero?!1:this.hasZero=!0;let e=this.hash(t);for(let i=0;i<this.max_iteration;++i){if(this.data[e]==t)return!1;if(this.data[e]==0)return this.data[e]=t,this.count++,!0;e=(e+1)%this.data.length}return this.rehash(),this.add(t)}has(t){if(t===0)return this.hasZero;let e=this.hash(t);for(let i=0;i<this.max_iteration;++i){if(this.data[e]==t)return!0;e=(e+1)%this.data.length}return!1}size(){return this.count}rehash(){const t=this.data;this.data=new Int32Array((this.data.length-1)*2+1);for(let e=0;e<t.length;++e)t[e]!=0&&this.add(t[e])}}function _(n){switch(n){case 0:return new N;case 1:return new $;case 2:return new L;default:throw new Error(`Unknown SetType ${n}`)}}function O(n,t,e){const i=()=>_(t);switch(n){case 0:return new U(e,i);case 1:return new T(e,i);default:throw new Error(`Unknown solver type ${n}`)}}const F=new v(2),x=new S(3),P=new E(2),j=[F,x],H=[F,x,P];onmessage=function(n){const t=n.data.task;V(n.data);try{switch(t.type){case"numbers":{const e=O(t.algorithm,t.set,c=>c);let{start:i,finish:s}=t,r=t.operations=="two"?j:H;const a=performance.now();t.order==="backward"&&(r=r.map(c=>c.inverse),i=s,s=t.start);const l=e.solve(i,s,r),u=performance.now(),o=l.operations.map(c=>t.order=="forward"?c.toString():c.inverse.toString());t.order=="backward"&&o.reverse(),I(n.data,{type:"numbers",timeMs:u-a,nodesVisited:l.visitedStates,operations:o});break}case"gameOfFifteens":{const e=new M(()=>new D),{start:i}=t,s=performance.now(),r=e.solve(i),a=performance.now();I(n.data,{type:"gameOfFifteens",timeMs:a-s,nodesVisited:r.visitedStates,operations:r.operations});break}default:b(n.data,"Unknown type of task");break}}catch(e){b(n.data,e instanceof Error?e.message:typeof e=="string"?e:JSON.stringify(e))}};function V(n){const t={taskId:n.taskId,status:"started",task:n.task,time:performance.now()};postMessage(t)}function I(n,t){const e={taskId:n.taskId,status:"resolved",task:n.task,result:t};postMessage(e)}function b(n,t){const e={taskId:n.taskId,status:"error",task:n.task,error:t};postMessage(e)}})();
