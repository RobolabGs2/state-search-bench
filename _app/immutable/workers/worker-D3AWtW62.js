var et=Object.defineProperty;var st=(S,y,x)=>y in S?et(S,y,{enumerable:!0,configurable:!0,writable:!0,value:x}):S[y]=x;var l=(S,y,x)=>st(S,typeof y!="symbol"?y+"":y,x);(function(){"use strict";class S{constructor(t=4096){l(this,"next");l(this,"data");l(this,"length",0);l(this,"head",0);this.cap=t,this.data=new Array(t)}get can_push(){return this.length<this.cap}get can_pop(){return this.head<this.length}push(t){this.data[this.length++]=t}pop(){return this.data[this.head++]}reset(){this.length=0,this.head=0,this.next=void 0}}class y{constructor(){l(this,"pull",[]);l(this,"head",new S);l(this,"tail",this.head)}push(t){if(!this.tail.can_push){const e=this.newChunk();this.tail.next=e,this.tail=e}this.tail.push(t)}pop(){if(this.head.can_pop)return this.head.pop();if(this.head.can_push||!this.head.next)throw new Error("Unexpected pop from empty queue");return this.pull.push(this.head),this.head=this.head.next,this.head.pop()}isEmpty(){return this.head===this.tail&&!this.head.can_pop}newChunk(){return new S}}let x=class{constructor(){l(this,"fields",new BigUint64Array(65536/4*256));l(this,"data",new Int32Array(65536*256));l(this,"index",0)}push(t,e,s,i,r){if(this.index+=1,this.data.length<=this.index*4){const d=new Int32Array(this.data.length*2),c=new BigUint64Array(this.fields.length*2);for(let h=0;h<this.data.length;++h)d[h]=this.data[h];for(let h=0;h<this.fields.length;++h)c[h]=this.fields[h];this.data=d,this.fields=c}const a=(this.index-1)*4;this.data[a+0]=t,this.data[a+1]=e,this.data[a+2]=i,this.data[a+3]=r,this.fields[this.index-1]=s}from(t){return this.data[t*4+0]}op(t){return this.data[t*4+1]}valueField(t){return this.fields[t]}valueEmpty(t){return this.data[t*4+2]}depth(t){return this.data[t*4+3]}length(){return this.index}},C=class{constructor(t){this.newSet=t}solve(t){const e=new x,s=g.fromArray(t);if(s.isSolution())return{ok:!0,operations:[],visitedStates:1};e.push(-1,-1,s.field,s.empty,0);const i=this.newSet();i.add(s.hash64());for(let r=0;r<e.length();++r){const a=e.valueField(r),d=e.valueEmpty(r),c=e.depth(r),h=e.op(r);for(let u=0;u<4;++u){const p=u;if(p===o.DOWN&&h===o.UP||p===o.UP&&h===o.DOWN||p===o.LEFT&&h===o.RIGHT||p===o.RIGHT&&h===o.LEFT||!g.canMove(d,p))continue;const[v,k]=g.makeMove(a,d,p);if(i.add(v)){if(v===g.solution){const m=new Array(c+1);m[c]=p;for(let I=r;e.op(I)>=0;I=e.from(I))m[e.depth(I)-1]=e.op(I);return{ok:!0,operations:m,visitedStates:i.size()}}e.push(r,p,v,k,c+1)}}}return{ok:!1,operations:[],visitedStates:i.size()}}};class N{constructor(){l(this,"maxDepth",0);l(this,"solution",[]);l(this,"visitedStates",0)}solve(t){this.maxDepth=1,this.solution=[],this.visitedStates=0;const e=g.fromArray(t);for(let s=1;s<=80;s++)if(this.maxDepth=s,this.dfs(e,-1))return{ok:!0,operations:this.solution,visitedStates:this.visitedStates};return{ok:!1,operations:[],visitedStates:this.visitedStates}}dfs(t,e,s=0){return this.visitedStates++,t.isSolution()?(this.solution=new Array(s),this.solution[s-1]=e,!0):s===this.maxDepth?!1:e!=o.RIGHT&&t.canMove(o.LEFT)&&this.dfs(t.makeMove(o.LEFT),o.LEFT,s+1)?(s>0&&(this.solution[s-1]=e),!0):e!=o.UP&&t.canMove(o.DOWN)&&this.dfs(t.makeMove(o.DOWN),o.DOWN,s+1)?(s>0&&(this.solution[s-1]=e),!0):e!=o.LEFT&&t.canMove(o.RIGHT)&&this.dfs(t.makeMove(o.RIGHT),o.RIGHT,s+1)?(s>0&&(this.solution[s-1]=e),!0):e!=o.DOWN&&t.canMove(o.UP)&&this.dfs(t.makeMove(o.UP),o.UP,s+1)?(s>0&&(this.solution[s-1]=e),!0):!1}}class O{constructor(){l(this,"maxDepth",0);l(this,"solution",[]);l(this,"visitedStates",0)}solve(t){this.maxDepth=1,this.solution=[],this.visitedStates=0;const e=E.fromArrayUint(t);for(let s=1;s<=80;s++)if(this.maxDepth=s,this.dfs(e,-1))return{ok:!0,operations:this.solution,visitedStates:this.visitedStates};return{ok:!1,operations:[],visitedStates:this.visitedStates}}dfs(t,e,s=0){if(this.visitedStates++,t.isSolution())return this.solution=new Array(s),this.solution[s-1]=e,!0;if(s===this.maxDepth)return!1;if(e!=o.RIGHT&&t.canMove(o.LEFT)){if(t.makeMoveInPlace(o.LEFT),this.dfs(t,o.LEFT,s+1))return s>0&&(this.solution[s-1]=e),!0;t.makeMoveInPlace(o.RIGHT)}if(e!=o.UP&&t.canMove(o.DOWN)){if(t.makeMoveInPlace(o.DOWN),this.dfs(t,o.DOWN,s+1))return s>0&&(this.solution[s-1]=e),!0;t.makeMoveInPlace(o.UP)}if(e!=o.LEFT&&t.canMove(o.RIGHT)){if(t.makeMoveInPlace(o.RIGHT),this.dfs(t,o.RIGHT,s+1))return s>0&&(this.solution[s-1]=e),!0;t.makeMoveInPlace(o.LEFT)}if(e!=o.DOWN&&t.canMove(o.UP)){if(t.makeMoveInPlace(o.UP),this.dfs(t,o.UP,s+1))return s>0&&(this.solution[s-1]=e),!0;t.makeMoveInPlace(o.DOWN)}return!1}}class L{solve(t){const e=new R,s=g.fromArray(t);if(s.isSolution())return{ok:!0,operations:[],visitedStates:1};let i=1;for(let r=1;r<=80;r++)for(e.push(-1,-1,s.field,s.empty,0,0);e.length();){const a=e.index-1,d=e.valueField(a),c=e.valueEmpty(a),h=e.depth(a);if(e.progress(a)){e.pop();continue}e.setProgress(a,1);const p=z(e.op(a));for(let v=0;v<4;++v){const k=v;if(k===p||!g.canMove(c,k))continue;const[m,I]=g.makeMove(d,c,k);if(i++,m===g.solution){const F=new Array(h+1);F[h]=k;for(let A=a;e.op(A)>=0;A=e.from(A))F[e.depth(A)-1]=e.op(A);return{ok:!0,operations:F,visitedStates:i}}h+1<r&&e.push(a,k,m,I,0,h+1)}h===r&&e.pop()}return{ok:!1,operations:[],visitedStates:i}}}class R{constructor(){l(this,"fields",new BigUint64Array(80*4));l(this,"data",new Int32Array(80*4*5));l(this,"index",0)}pop(){this.index-=1}push(t,e,s,i,r,a){if(this.index+=1,this.data.length<=this.index*5){console.log("UNEXPECTED RESIZE",this.data.length,this.index,a);const c=new Int32Array(this.data.length*2),h=new BigUint64Array(this.fields.length*2);for(let u=0;u<this.data.length;++u)c[u]=this.data[u];for(let u=0;u<this.fields.length;++u)h[u]=this.fields[u];this.data=c,this.fields=h}const d=(this.index-1)*5;this.data[d+0]=t,this.data[d+1]=e,this.data[d+2]=i,this.data[d+3]=r,this.data[d+4]=a,this.fields[this.index-1]=s}from(t){return this.data[t*5+0]}op(t){return this.data[t*5+1]}valueField(t){return this.fields[t]}valueEmpty(t){return this.data[t*5+2]}progress(t){return this.data[t*5+3]}setProgress(t,e){this.data[t*5+3]=e}depth(t){return this.data[t*5+4]}length(){return this.index}}class H{constructor(){l(this,"data",new BigUint64Array(65536*256+1));l(this,"count",0);l(this,"hasZero",!1)}get max_iteration(){return 15/65537*this.data.length|0}hash(t){return t=BigInt.asUintN(64,(t>>16n^t)*0x45d9f3bn),t=BigInt.asUintN(64,(t>>16n^t)*0x45d9f3bn),Number(t%BigInt(this.data.length))}add(t){if(t===0n)return this.hasZero?!1:(this.count++,this.hasZero=!0);let e=this.hash(t);const s=e;for(let i=0;i<this.max_iteration;++i){if(this.data[e]==t)return!1;if(this.data[e]==0n)return this.data[e]=t,this.count++,!0;e=(s+(i+1))%this.data.length}return this.rehash(),this.add(t)}size(){return this.count}rehash(){const t=this.data;this.data=new BigUint64Array((this.data.length-1)*2+1),this.count=+this.hasZero;for(let e=0;e<t.length;++e)t[e]!=0n&&this.add(t[e])}}var o=(n=>(n[n.UP=0]="UP",n[n.RIGHT=1]="RIGHT",n[n.DOWN=2]="DOWN",n[n.LEFT=3]="LEFT",n))(o||{});function W(n){switch(n){case 0:return new C(()=>new H);case 1:return new N;case 3:return new L;case 2:return new O}}function z(n){switch(n){case 0:return 2;case 1:return 3;case 2:return 0;case 3:return 1}return-1}class E{constructor(t,e){this.field=t,this.empty=e}static fromArray(t){let e=0;for(let s=0;s<16;s++)if(t[s]===0){e=s;break}return new E(t.slice(0),e)}static fromArrayUint(t){const e=new Uint8Array(16);let s=0;for(let i=0;i<16;i++)t[i]===0&&(s=i),e[i]=t[i];return new E(e,s)}canMove(t){const e=this.empty%4;switch(t){case 0:return this.empty>3;case 2:return this.empty<12;case 3:return e>0;case 1:return e<3}return!1}makeMove(t){return this.copy().makeMoveInPlace(t)}makeMoveInPlace(t){let e=this.empty;switch(t){case 0:e=this.empty-4;break;case 2:e=this.empty+4;break;case 3:e=this.empty-1;break;case 1:e=this.empty+1;break}return this.field[this.empty]=this.field[e],this.field[e]=0,this.empty=e,this}copy(){return new E(this.field.slice(0),this.empty)}hash64(){const t=this.field,e=BigInt(t[3]<<12|t[2]<<8|t[1]<<4|t[0]),s=BigInt(t[7]<<12|t[6]<<8|t[5]<<4|t[4]),i=BigInt(t[11]<<12|t[10]<<8|t[9]<<4|t[8]),r=BigInt(t[15]<<12|t[14]<<8|t[13]<<4|t[12]);return BigInt.asUintN(64,r<<48n|i<<32n|s<<16n|e)}isSolution(){if(this.empty!=15)return!1;for(let t=0;t<15;t++)if(this.field[t]!=t+1)return!1;return!0}}const w=class w{constructor(t,e){this.field=t,this.empty=e}static fromArray(t){let e=0;for(let i=0;i<16;i++)if(t[i]===0){e=i;break}const s=new E(t.slice(0),e);return new w(s.hash64(),e)}canMove(t){return w.canMove(this.empty,t)}static canMove(t,e){const s=t%4;switch(e){case 0:return t>3;case 2:return t<12;case 3:return s>0;case 1:return s<3}return!1}makeMove(t){const[e,s]=w.makeMove(this.field,this.empty,t);return new w(e,s)}static makeMove(t,e,s){let i=e;switch(s){case 0:i=e-4;break;case 2:i=e+4;break;case 3:i=e-1;break;case 1:i=e+1;break}const r=w.masks[i];let a=t&r;return a=a>>BigInt(i*4),a=a<<BigInt(e*4),t=t&~r|a,e=i,[t,e]}makeMoveInPlace(t){return[this.field,this.empty]=w.makeMove(this.field,this.empty,t),this}copy(){return new w(this.field,this.empty)}hash64(){return this.field}isSolution(){return this.field===w.solution}};l(w,"masks",[]),l(w,"solution",new E([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0],15).hash64());let g=w;for(let n=0;n<16;n++)g.masks[n]=0xfn<<BigInt(n*4);function f(n){return n.padEnd(16,"0").substring(0,16).split("").map(t=>parseInt(t,16))}f("123456789ABCDEF0"),f("1234067859ACDEBF"),f("5134207896ACDEBF"),f("16245A3709C8DEBF"),f("1723068459ACDEBF"),f("0723168459ACDEBF"),f("7023168459ACDEBF"),f("7203168459ACDEBF"),f("7283160459ACDEBF"),f("7283106459ACDEBF"),f("12345678A0BE9FCD"),f("51247308A6BE9FCD"),f("F2345678A0BE91DC"),f("75123804A6BE9FCD"),f("75AB2C416D389F0E"),f("04582E1DF79BCA36"),f("FE169B4C0A73D852"),f("D79F2E8A45106C3B"),f("DBE87A2C91F65034"),f("BAC0F478E19623D5");class Z{constructor(t,e){this.hash=t,this.newSet=e}solve(t,e,s){const i=new y;i.push({value:t,depth:0});const r=this.newSet();for(r.add(this.hash(t));!i.isEmpty();){const a=i.pop();for(let d=0;d<s.length;++d){const c=s[d];if(!c.correct(a.value))continue;const h=c.apply(a.value);if(r.add(this.hash(h))){if(h===e){const u=new Array(a.depth+1);u[a.depth]=c;for(let p=a;p.op;p=p.from)u[p.depth-1]=p.op;return{ok:!0,operations:u,visitedStates:r.size()}}i.push({from:a,op:c,value:h,depth:a.depth+1})}}}return{ok:!1,operations:[],visitedStates:r.size()}}}class G{constructor(){l(this,"data",new Int32Array(65536));l(this,"index",0)}push(t,e,s,i){if(this.index+=1,this.data.length<=this.index*4){const a=new Int32Array(this.data.length*2);for(let d=0;d<this.data.length;++d)a[d]=this.data[d];this.data=a}const r=(this.index-1)*4;this.data[r+0]=t,this.data[r+1]=e,this.data[r+2]=s,this.data[r+3]=i}from(t){return this.data[t*4+0]}op(t){return this.data[t*4+1]}value(t){return this.data[t*4+2]}depth(t){return this.data[t*4+3]}length(){return this.index}}class ${constructor(t,e){this.hash=t,this.newSet=e}solve(t,e,s){const i=new G;i.push(-1,-1,t,0);const r=this.newSet();r.add(this.hash(t));for(let a=0;a<i.length();++a){const d=i.value(a),c=i.depth(a);for(let h=0;h<s.length;++h){const u=s[h];if(!u.correct(d))continue;const p=u.apply(d),v=this.hash(p);if(r.add(v)){if(p===e){const k=new Array(c+1);k[c]=u;for(let m=a;i.op(m)>=0;m=i.from(m))k[i.depth(m)-1]=s[i.op(m)];return{ok:!0,operations:k,visitedStates:r.size()}}i.push(a,h,p,c+1)}}}return{ok:!1,operations:[],visitedStates:r.size()}}}class D{constructor(t,e=new B(t,this)){this.n=t,this.inverse=e}apply(t){return t+this.n}correct(){return!0}toString(){return`+${this.n}`}}class B{constructor(t,e=new D(t,this)){this.n=t,this.inverse=e}apply(t){return t-this.n}correct(){return!0}toString(){return`-${this.n}`}}class M{constructor(t,e=new _(t,this)){this.n=t,this.inverse=e}apply(t){return t*this.n}correct(){return!0}toString(){return`*${this.n}`}}class _{constructor(t,e=new M(t,this)){this.n=t,this.inverse=e}apply(t){return t/this.n}correct(t){return t%this.n===0}toString(){return`/${this.n}`}}class j{constructor(){l(this,"root");l(this,"count",0)}add(t){if(!this.root)return this.root={value:t,left:void 0,right:void 0},this.count++,!0;let e=this.root,s=this.root,i=!1;for(;e;)if(s=e,i=t<e.value,i)e=e.left;else if(e.value<t)e=e.right;else return!1;this.count++;const r={value:t,left:void 0,right:void 0};return i?s.left=r:s.right=r,!0}has(t){let e=this.root;for(;e;)if(t<e.value)e=e.left;else if(e.value<t)e=e.right;else return!0;return!1}size(){return this.count}}class V{constructor(){l(this,"data",Object.create(null));l(this,"count",0)}add(t){return this.data[t]?!1:(this.count++,this.data[t]=!0)}has(t){return this.data[t]}size(){return this.count}}class q{constructor(){l(this,"data",new Int32Array(65537));l(this,"max_iteration",15);l(this,"count",0);l(this,"hasZero",!1)}hash(t){return t=(t>>16^t)*73244475|0,t=(t>>16^t)*73244475|0,t=t>>16^t|0,t%this.data.length}add(t){if(t===0)return this.hasZero?!1:this.hasZero=!0;let e=this.hash(t);for(let s=0;s<this.max_iteration;++s){if(this.data[e]==t)return!1;if(this.data[e]==0)return this.data[e]=t,this.count++,!0;e=(e+1)%this.data.length}return this.rehash(),this.add(t)}has(t){if(t===0)return this.hasZero;let e=this.hash(t);for(let s=0;s<this.max_iteration;++s){if(this.data[e]==t)return!0;e=(e+1)%this.data.length}return!1}size(){return this.count}rehash(){const t=this.data;this.data=new Int32Array((this.data.length-1)*2+1);for(let e=0;e<t.length;++e)t[e]!=0&&this.add(t[e])}}function J(n){switch(n){case 0:return new V;case 1:return new j;case 2:return new q;default:throw new Error(`Unknown SetType ${n}`)}}function Q(n,t,e){const s=()=>J(t);switch(n){case 0:return new Z(e,s);case 1:return new $(e,s);default:throw new Error(`Unknown solver type ${n}`)}}const T=new M(2),U=new D(3),X=new B(2),K=[T,U],Y=[T,U,X];onmessage=function(n){const t=n.data.task;tt(n.data);try{switch(t.type){case"numbers":{const e=Q(t.algorithm,t.set,u=>u);let{start:s,finish:i}=t,r=t.operations=="two"?K:Y;const a=performance.now();t.order==="backward"&&(r=r.map(u=>u.inverse),s=i,i=t.start);const d=e.solve(s,i,r),c=performance.now(),h=d.operations.map(u=>t.order=="forward"?u.toString():u.inverse.toString());t.order=="backward"&&h.reverse(),b(n.data,{type:"numbers",timeMs:c-a,nodesVisited:d.visitedStates,operations:h});break}case"gameOfFifteens":{const e=W(t.algorithm),{start:s}=t,i=performance.now(),r=e.solve(s),a=performance.now();b(n.data,{type:"gameOfFifteens",timeMs:a-i,nodesVisited:r.visitedStates,operations:r.operations});break}default:P(n.data,"Unknown type of task");break}}catch(e){P(n.data,e instanceof Error?e.message:typeof e=="string"?e:JSON.stringify(e))}};function tt(n){const t={taskId:n.taskId,status:"started",task:n.task,time:performance.now()};postMessage(t)}function b(n,t){const e={taskId:n.taskId,status:"resolved",task:n.task,result:t};postMessage(e)}function P(n,t){const e={taskId:n.taskId,status:"error",task:n.task,error:t};postMessage(e)}})();
